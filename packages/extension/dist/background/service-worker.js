const a=new Map;function n(o){if(!o)return!1;try{const e=new URL(o);return e.hostname==="localhost"||e.hostname==="127.0.0.1"}catch{return!1}}function s(o){if(!o)return null;try{return new URL(o).origin}catch{return null}}chrome.action.onClicked.addListener(async o=>{if(!(!o.id||!o.url))if(n(o.url))try{const e=s(o.url);e&&a.set(e,!0),await chrome.sidePanel.open({tabId:o.id}),console.log(`[VDev] Opened sidepanel for ${e}`)}catch(e){console.error("[VDev] Error opening sidepanel:",e)}else{try{await chrome.action.setBadgeText({text:"!",tabId:o.id}),await chrome.action.setBadgeBackgroundColor({color:"#ef4444",tabId:o.id}),setTimeout(async()=>{try{await chrome.action.setBadgeText({text:"",tabId:o.id})}catch{}},2e3)}catch(e){console.error("[VDev] Error setting badge:",e)}console.log("[VDev] Cannot open sidepanel on non-localhost page")}});chrome.tabs.onActivated.addListener(async o=>{try{const e=await chrome.tabs.get(o.tabId);if(!e.url)return;const t=s(e.url);n(e.url)&&t&&a.get(t)&&(await chrome.sidePanel.open({tabId:o.tabId}),console.log(`[VDev] Auto-restored sidepanel for ${t}`))}catch(e){console.error("[VDev] Error handling tab activation:",e)}});chrome.tabs.onUpdated.addListener(async(o,e,t)=>{if(e.url)try{const r=s(e.url);n(e.url)&&r&&a.get(r)&&(await chrome.sidePanel.open({tabId:o}),console.log(`[VDev] Auto-restored sidepanel for ${r} after navigation`))}catch(r){console.error("[VDev] Error handling tab update:",r)}});chrome.runtime.onMessage.addListener((o,e,t)=>((o.type==="VDEV_ELEMENT_SELECTED"||o.type==="VDEV_SDK_READY"||o.type==="VDEV_INSPECT_STATE_CHANGED")&&chrome.runtime.sendMessage(o),!0));chrome.commands.onCommand.addListener(async o=>{if(o==="toggle-inspect")try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(e!=null&&e.id)||!(e!=null&&e.url))return;n(e.url)?(await chrome.tabs.sendMessage(e.id,{type:"VDEV_TOGGLE_INSPECT"}),console.log("[VDev] Toggled inspect mode via keyboard shortcut")):console.log("[VDev] Cannot toggle inspect on non-localhost page")}catch(e){console.error("[VDev] Error handling keyboard shortcut:",e)}});chrome.runtime.onInstalled.addListener(()=>{console.log("[VDev Extension] Installed")});
