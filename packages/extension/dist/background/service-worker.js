const c=new Map;function n(t){if(!t)return!1;try{const e=new URL(t);return e.hostname==="localhost"||e.hostname==="127.0.0.1"}catch{return!1}}function i(t){if(!t)return null;try{return new URL(t).origin}catch{return null}}async function a(t){try{await chrome.scripting.executeScript({target:{tabId:t},files:["content/content-script.js"]}),console.log(`[VDev] Injected content script into tab ${t}`)}catch(e){console.log(`[VDev] Note: Script injection attempt on ${t}: ${e}`)}}chrome.action.onClicked.addListener(async t=>{if(!(!t.id||!t.url))if(n(t.url))try{const e=i(t.url);e&&c.set(e,!0),await chrome.sidePanel.open({tabId:t.id}),console.log(`[VDev] Opened sidepanel for ${e}`)}catch(e){console.error("[VDev] Error opening sidepanel:",e)}else{try{await chrome.action.setBadgeText({text:"!",tabId:t.id}),await chrome.action.setBadgeBackgroundColor({color:"#ef4444",tabId:t.id}),setTimeout(async()=>{try{await chrome.action.setBadgeText({text:"",tabId:t.id})}catch{}},2e3)}catch(e){console.error("[VDev] Error setting badge:",e)}console.log("[VDev] Cannot open sidepanel on non-localhost page")}});chrome.tabs.onActivated.addListener(async t=>{try{const e=await chrome.tabs.get(t.tabId);if(!e.url)return;const r=i(e.url);n(e.url)&&r&&c.get(r)&&(await chrome.sidePanel.open({tabId:t.tabId}),console.log(`[VDev] Auto-restored sidepanel for ${r}`))}catch(e){console.error("[VDev] Error handling tab activation:",e)}});chrome.tabs.onUpdated.addListener(async(t,e,r)=>{if(e.url)try{const o=i(e.url);n(e.url)&&o&&c.get(o)&&(await chrome.sidePanel.open({tabId:t}),console.log(`[VDev] Auto-restored sidepanel for ${o} after navigation`))}catch(o){console.error("[VDev] Error handling tab update:",o)}});chrome.runtime.onMessage.addListener((t,e,r)=>((t.type==="VDEV_ELEMENT_SELECTED"||t.type==="VDEV_SDK_READY"||t.type==="VDEV_INSPECT_STATE_CHANGED")&&chrome.runtime.sendMessage(t),!0));chrome.commands.onCommand.addListener(async t=>{if(t==="toggle-inspect")try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(e!=null&&e.id)||!(e!=null&&e.url))return;n(e.url)?(await chrome.tabs.sendMessage(e.id,{type:"VDEV_TOGGLE_INSPECT"}),console.log("[VDev] Toggled inspect mode via keyboard shortcut")):console.log("[VDev] Cannot toggle inspect on non-localhost page")}catch(e){console.error("[VDev] Error handling keyboard shortcut:",e)}});chrome.runtime.onInstalled.addListener(async()=>{console.log("[VDev Extension] Installed");try{const t=await chrome.tabs.query({});for(const e of t)e.id&&e.url&&n(e.url)&&await a(e.id)}catch(t){console.error("[VDev] Error injecting content scripts on install:",t)}});
